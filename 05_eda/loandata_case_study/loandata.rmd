Loan Data Case Study by Timothy Short
========================================================

```{r echo=FALSE, packages}
library(ggplot2)
library(plyr)
```

```{r echo=FALSE, Load_the_Data}
df = read.csv('data/prosperLoanData.csv', header=T)
head(df)
names(df)
```

There are 113,937 observations with 81 variables to analyze. Variables include
basic loan information and applicant information, to detailed description of
the loan backer and financial institution information. Most variables are
numerica with String variables as factor variables.

There are many different case studies to analyze, from trends of lower income
to upper income customers, to analyzing what products customers will seek
to finance, to the credit worthiness of the borrower and / or the loan.

We want to analyze the various Loan Status' and see which variables seem to
impact and help identify trends among a borrower's loan. Below are

```{r}
print(summary(na.omit(df)))
#Borrower Profile
summary((df$CreditScoreRangeLower + df$CreditScoreRangeLower)/2)
table(df$OpenCreditLines)
summary(df$IncomeRange)
summary(df$DebtToIncomeRatio)
table(df$TotalInquiries)
table(df$EmploymentStatus)
table(df$IsBorrowerHomeowner)

#Current Loan Data
count(df$LoanStatus)
summary(df$LoanCurrentDaysDelinquent)
table(df$CreditGrade)
summary(df$MonthlyLoanPayment)
```

Make preliminary changes to data set

```{r InitializeVariables}
#Calculate the mean credit score (upper - lower)
df$CreditScoreMean = (df$CreditScoreRangeUpper + df$CreditScoreRangeLower)/2

#Factor the credit grade
df$CreditGrade = factor(df$CreditGrade, levels = c('NC', 'HR', 'E', 'D', 'C', 'B', 'A', 'AA'))

#Factor income levels
df$IncomeRange = factor(df$IncomeRange, levels = c('$0', '$1-24,999', '$25,000-49,999', '$50,000-74,999', '$75,000-99,999', '$100,000+',  'Not displayed', 'Not employed'))

#Define variable analysis as array
borrowerProfile = c( "CreditScoreMean" , "OpenCreditLines" , "IncomeRange" ,
  "DebtToIncomeRatio" , "TotalInquiries" , "EmploymentStatus" , "IsBorrowerHomeowner" )
loanData = c( "LoanStatus" , "LoanCurrentDaysDelinquent" , "CreditGrade" , "MonthlyLoanPayment")
```

### Data Observations
- EmploymentStatus: 2255 observations are EMPTY
- CreditGrade: 84984 observations are EMPTY or NC
- TotalInquiries: extreme outliers of 377 and 379

# Univariate Plots

```{r echo=FALSE, Univariate_Plots: Loan Data}
#Bar graph to show the count of each loan status
ggplot(aes(x=LoanStatus), y=count(LoanStatus), data=df) +
  geom_bar() + 
  ggtitle('Counts of Loan Status') +
  ggsave('visualizations/univariate-loandata/loanstatus.png')

#Histogram to show the counts of days for loan deliquency
ggplot(aes(x=LoanCurrentDaysDelinquent), data=subset(df,df$LoanCurrentDaysDelinquent>0)) +
  geom_histogram(binwidth = 30) +
  scale_x_continuous(breaks=seq(1,365*30,365), labels=c(0:29)) +
  xlab('Year Delinquent') +
  ggtitle('Distribution of Loan Delinquency in Years') +
  ggsave('visualizations/univariate-loandata/daysdelinquent.png')

#Bar grapch to show counts of different credit grades of the loan
ggplot(aes(x=CreditGrade), y=count(CreditGrade), data=subset(df, df$CreditGrade!="")) +
  geom_bar() + 
  ggtitle('Distribution of Loan Credit Grades') +
  ggsave('visualizations/univariate-loandata/creditgrade.png')

#Boxplot to show distribution of monthly payments
ggplot(data=df, aes(x="", y=MonthlyLoanPayment)) +
  scale_y_continuous(limits=c(0,1500)) +
  xlab("") +
  geom_boxplot() +
  ggtitle('Distribution of Monthly Payment') +
  ggsave('visualizations/univariate-loandata/monthlypayment.png')

#Bar graph to show listing category
listingNames = c("Debt Consolidation", "Home Improvement", "Business", "Personal Loan", "Student Use", "Auto", "Other", "Baby&Adoption", "Boat", "Cosmetic Procedure", "Engagement Ring", "Green Loans", "Household Expenses", "Large Purchases", "Medical/Dental", "Motorcycle", "RV", "Taxes", "Vacation", "Wedding Loans")
table(df$ListingCategory..numeric.)
ggplot(data=df, aes(x=ListingCategory..numeric.)) +
  geom_histogram(bins=20, binwidth = .5) +
  scale_x_continuous(limits = c(0,21), breaks=seq(1,20,1), labels = listingNames) +
  theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=.95)) +
  xlab('Listing Category') + 
  ggtitle('Loan Listing Category') +
  ggsave('visualizations/univariate-loandata/loanpurpose.png')

#Loan Amount
ggplot(df, aes(x=LoanOriginalAmount)) +
  geom_histogram() +
  ggtitle('Distribution of Loan Amounts') +
  ggsave('visualizations/univariate-loandata/loanamount.png')
```


```{r echo=FALSE, Univariate_Plots: Borrower Profile}
#Histogram to show total credit inquiries of each loan's borrower
ggplot(aes(x=TotalInquiries), y=count(df$TotalInquiries), data=df) +
  geom_histogram(binwidth = 1) +
  scale_x_continuous(limits=c(-1,25)) +
  ggtitle('Distribution of Total Credit Inquiries\nRange: 0 to 25') +
  ggsave('visualizations/univariate-borrowerprofile/totalinquiries.png')

#Histogram to show distribution of current open credit lines for each loan's borrower
ggplot(data=df, aes(x=OpenCreditLines)) +
  geom_histogram() +
  ggtitle("Distribution of Borrower's Open Credit Lines") +
  ggsave('visualizations/univariate-borrowerprofile/opencreditlines.png')

#Bar graph to show distribution of borrower's income range
ggplot(data=df, aes(x=IncomeRange)) +
  geom_bar() +
  ggtitle('Distribution of Borrowers Income') +
  theme(axis.text.x = element_text(angle=45, vjust=.95, hjust=.95)) +
  ggsave('visualizations/univariate-borrowerprofile/incomerange.png')

#Histogram to show distribution of borrowers mean credit score
ggplot(data=df, aes(x=CreditScoreMean)) +
  xlim(450, 850) +
  geom_histogram(binwidth=10) +
  ggtitle('Distribution of Borrowers Mean Credit Score') +
  ggsave('visualizations/univariate-borrowerprofile/creditscores.png')

#Histogram of borrowers debt-to-income ratio
ggplot(aes(x=DebtToIncomeRatio), data=df) +
  xlim(0,1) +
  geom_histogram() +
  ggtitle('Distribution of Borrowers Debt to Income Ratio')
  ggsave('visualizations/univariate-borrowerprofile/debtincomeratio.png')

#Bar graph of borrowers employment status
ggplot(aes(x=EmploymentStatus), y=count(EmploymentStatus), data=subset(df, df$EmploymentStatus!="")) +
  geom_bar() +
  ggtitle('Distribution of Employment Status') +
  ggsave('visualizations/univariate-borrowerprofile/employmentstatus.png')

#Bar graph of borrowers homeownersip
ggplot(aes(x=IsBorrowerHomeowner), y=count(IsBorrowerHomeowner), data=df) +
  geom_bar() +
  ggtitle('Distribution of Homeowner Status') +
  ggsave('visualizations/univariate-borrowerprofile/homeowner.png')
```

# Univariate Analysis

I am interested in investigating any correlation to the loan status. I chose
a handful of variables relative to the loan's financial information and a
handful of variables relative to the borrower's profile.

I created one new variable to analyze the borrowers credit score. The dataset
included an upper and lower range of the credit score; I simplified this into
one number - the mean credit score.

There were some adjustments to the dataset, including empty values. There
appears to be some obvious distributions that I would like to analyze.

Going forward, I want to analyze loans that are in good condition (completed
or current) and loans that are in bad condition (defaulted or charged off).
From here, we can look for some important indicators to anticipate and
predict the result of loans that are past due.

# Bivariate Plots Section

```{r echo=FALSE, Bivariate_Plots}
ggplot(data=df, aes(x=ListingCategory..numeric., y=LoanStatus)) +
  geom_jitter(alpha=.1, size=.01, width=.3, height=.3) +
  scale_x_continuous(limits = c(1,21), breaks=seq(1,20,1), labels = listingNames) +
  theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=.95)) +
  xlab('Loan Listing Type') +
  ggtitle('Loan Status by Listing Category') + 
  ggsave('visualizations/bivariate/loanstatus_loantype.png')

ggplot(data=df, aes(x=ListingCategory..numeric., y=LoanOriginalAmount)) +
  stat_summary(fun.y='median', geom='bar') +
  scale_x_continuous(limits = c(0,21), breaks=seq(1,20,1), labels = listingNames) +
  theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=.95)) +
  xlab('Loan Listing Type') +
  ylab('Median Original Loan Amount') +
  ggtitle('Median Loan by Loan Type') +
  ggsave('visualizations/bivariate/loanamount_loantype.png')

ggplot(data=df, aes(y=ListingCategory..numeric., x=CreditScoreMean)) +
  geom_jitter(alpha=.1, size=.1) +
  scale_y_continuous(limits = c(1,21), breaks=seq(1,20,1), labels = listingNames) +
  scale_x_continuous(limits = c(500, 850), breaks=seq(500,850,50)) +
  theme(axis.text.y = element_text(hjust=.95)) +
  ylab('Loan Listing Type') +
  xlab('Mean Credit Score') +
  ggtitle('Loan Category by Credit Score') +
  ggsave('visualizations/bivariate/loantype_creditscore.png')

ggplot(aes(x=CreditScoreMean, y=CreditGrade), data=subset(df, df$CreditGrade!="" & df$CreditGrade!='NC')) +
  geom_jitter(alpha=.1, size=.1) +
  xlim(400,900) +
  ggtitle('Loands Credit Grade by Credit Score') +
  ggsave('visualizations/bivariate/creditgrade_creditscore.png')

ggplot(aes(x=IncomeRange, y=CreditScoreMean), data=subset(df, df$CreditScoreMean > 50)) +
  geom_jitter(alpha=.03) +
  ggtitle('Mean Credit Scores by Income') +
  theme(axis.text.x = element_text(angle=45, vjust=.95, hjust=.95)) +
  ggsave('visualizations/bivariate/creditscore_income.png')

ggplot(aes(x=ListingCategory..numeric., y=IncomeRange), data=subset(df, df$IncomeRange!='Not employed' & df$IncomeRange!='Not displayed')) +
  geom_jitter(alpha=.01) +
  scale_x_continuous(limits = c(1,21), breaks=seq(1,20,1), labels = listingNames) +
  theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=.95)) +
  xlab('Loan Listing Type') +
  ggtitle('Income Range by Loan Type\nWho is financing what?') +
  ggsave('visualizations/bivariate/incomerange_loantype.png')

ggplot(aes(x=LoanStatus), y=LoanStatus, data=df) +
  geom_bar(aes(y=..count../sum(..count..))) +
  theme(axis.text.x = element_text(angle=45, vjust=.95, hjust=.95)) +
  facet_wrap(~df$IsBorrowerHomeowner) +
  ggtitle('Comparing Loan Status by Homeowernship') +
  ggsave('visualizations/bivariate/loanstatus_homeownership.png')

ggplot(aes(x=LoanStatus, y=EmploymentStatus), data=df) +
  geom_jitter(alpha=.01) +
  theme(axis.text.x = element_text(angle=45, vjust=.95, hjust=.95))
  ggtitle('Employment Status by Loan Status') +
  ggsave('visualizations/bivariate/employment_loanstatus.png')

```

# Bivariate Analysis

### Talk about some of the relationships you observed in this part of the \
investigation. How did the feature(s) of interest vary with other features in \
the dataset?

### Did you observe any interesting relationships between the other features \
(not the main feature(s) of interest)?

### What was the strongest relationship you found?


# Multivariate Plots Section

> **Tip**: Now it's time to put everything together. Based on what you found in
the bivariate plots section, create a few multivariate plots to investigate
more complex interactions between variables. Make sure that the plots that you
create here are justified by the plots you explored in the previous section. If
you plan on creating any mathematical models, this is the section where you
will do that.

```{r echo=FALSE, Multivariate_Plots}

```

# Multivariate Analysis

### Talk about some of the relationships you observed in this part of the \
investigation. Were there features that strengthened each other in terms of \
looking at your feature(s) of interest?

### Were there any interesting or surprising interactions between features?

### OPTIONAL: Did you create any models with your dataset? Discuss the \
strengths and limitations of your model.

------

# Final Plots and Summary

> **Tip**: You've done a lot of exploration and have built up an understanding
of the structure of and relationships between the variables in your dataset.
Here, you will select three plots from all of your previous exploration to
present here as a summary of some of your most interesting findings. Make sure
that you have refined your selected plots for good titling, axis labels (with
units), and good aesthetic choices (e.g. color, transparency). After each plot,
make sure you justify why you chose each plot by describing what it shows.

### Plot One
```{r echo=FALSE, Plot_One}

```

### Description One


### Plot Two
```{r echo=FALSE, Plot_Two}

```

### Description Two


### Plot Three
```{r echo=FALSE, Plot_Three}

```

### Description Three

------

# Reflection

> **Tip**: Here's the final step! Reflect on the exploration you performed and
the insights you found. What were some of the struggles that you went through?
What went well? What was surprising? Make sure you include an insight into
future work that could be done with the dataset.

> **Tip**: Don't forget to remove this, and the other **Tip** sections before
saving your final work and knitting the final report!